<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>إدارة المستخدمين - نظام إدارة محطات الكهرباء</title>
    <script src="/assets/js/tailwind.js"></script>
    <link rel="stylesheet" href="/assets/css/remixicon.css" />
    <link rel="stylesheet" href="/assets/css/main.css" />
    <link rel="stylesheet" href="/assets/css/users.css" />
  </head>
  <body class="bg-gray-50">
    <div class="flex h-screen overflow-hidden">
      <div id="sidebar"></div>
      <div class="flex-1 flex flex-col overflow-hidden">
        <div id="header"></div>
        <main class="main-content p-4 md:p-6">
          <div class="bg-white rounded-lg shadow-sm mb-6 overflow-hidden">
            <div class="flex border-b">
              <button
                id="tab-accounts"
                class="tab-btn active px-6 py-4 font-medium text-primary"
              >
                حسابات مستخدمين النظام
              </button>
              <button
                id="tab-employes"
                class="tab-btn px-6 py-4 font-medium text-gray-500 hover:text-gray-700"
              >
                حسابات الموظفين
              </button>
              <button
                id="tab-roles"
                class="tab-btn px-6 py-4 font-medium text-gray-500 hover:text-gray-700"
              >
                الأدوار والصلاحيات
              </button>
              <button
                id="tab-logs"
                class="tab-btn px-6 py-4 font-medium text-gray-500 hover:text-gray-700"
              >
                سجل النشاط
              </button>
              <button
                id="tab-notify"
                class="tab-btn px-6 py-4 font-medium text-gray-500 hover:text-gray-700"
              >
                مستويات الإشعارات
              </button>
            </div>
          </div>
          <!--! Users Tab Content -->
          <div
            id="content-accounts"
            class="tab-content active bg-white p-6 rounded-lg shadow-sm"
          >
            <div class="flex justify-between items-center mb-6">
              <div class="flex items-center">
                <div class="relative">
                  <input
                    type="text"
                    id="searchInput"
                    placeholder="بحث عن مستخدم..."
                    class="pr-10 pl-4 py-2 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-20 focus:border-primary"
                  />
                  <div class="absolute right-3 top-2.5 text-gray-400">
                    <i class="ri-search-line"></i>
                  </div>
                </div>
                <div class="custom-select mr-3">
                  <div class="custom-select-selected text-sm">
                    <span>جميع المستخدمين</span>
                    <i class="ri-arrow-down-s-line"></i>
                  </div>
                  <div class="custom-select-options">
                    <div class="custom-select-option text-sm" data-filter="all">
                      جميع المستخدمين
                    </div>
                    <div
                      class="custom-select-option text-sm"
                      data-filter="active"
                    >
                      المستخدمين النشطين
                    </div>
                    <div
                      class="custom-select-option text-sm"
                      data-filter="inactive"
                    >
                      المستخدمين المعطلين
                    </div>
                    <div
                      class="custom-select-option text-sm"
                      data-filter="admin"
                    >
                      المدراء
                    </div>
                    <div
                      class="custom-select-option text-sm"
                      data-filter="engineer"
                    >
                      المهندسين
                    </div>
                    <div
                      class="custom-select-option text-sm"
                      data-filter="technician"
                    >
                      الفنيين
                    </div>
                  </div>
                </div>
              </div>
              <button
                id="addEmployeeBtn"
                class="bg-blue-500 text-white px-4 py-2 rounded-button text-sm font-medium flex items-center whitespace-nowrap"
              >
                <div class="w-5 h-5 flex items-center justify-center ml-1">
                  <i class="ri-user-add-line"></i>
                </div>
                <span>إضافة مستخدم جديد</span>
              </button>
            </div>
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                  <tr>
                    <th
                      scope="col"
                      class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      <label class="custom-checkbox">
                        <input type="checkbox" id="selectAll" />
                        <span class="checkmark"></span>
                      </label>
                      المستخدم
                    </th>
                    <th
                      scope="col"
                      class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      الدور
                    </th>
                    <th
                      scope="col"
                      class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      البريد الإلكتروني
                    </th>
                    <th
                      scope="col"
                      class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      رقم الهاتف
                    </th>
                    <th
                      scope="col"
                      class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      تاريخ الإنشاء
                    </th>
                    <th
                      scope="col"
                      class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      الحالة
                    </th>
                    <th
                      scope="col"
                      class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      الإجراءات
                    </th>
                  </tr>
                </thead>
                <tbody
                  id="usersTableBody"
                  class="bg-white divide-y divide-gray-200"
                >
                  <!-- سيتم ملؤها بواسطة JavaScript -->
                </tbody>
              </table>
            </div>
            <div class="flex items-center justify-between mt-6">
              <div class="text-sm text-gray-500" id="usersCount">
                عرض 0-0 من 0 مستخدم
              </div>
              <div
                class="flex items-center space-x-reverse space-x-2"
                id="pagination"
              >
                <!-- سيتم ملؤها بواسطة JavaScript -->
              </div>
            </div>
          </div>
          <!--! Logs Tab Content -->
          <div
            id="content-logs"
            class="tab-content bg-white p-6 rounded-lg shadow-sm hidden"
          >
            <div class="flex justify-between items-center mb-6">
              <h3 class="text-lg font-medium text-gray-900">سجلات النشاط</h3>
              <div class="flex items-center">
                <div class="relative ml-3">
                  <input
                    type="text"
                    placeholder="بحث في السجلات..."
                    class="pr-10 pl-4 py-2 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-20 focus:border-primary"
                  />
                  <div class="absolute right-3 top-2.5 text-gray-400">
                    <i class="ri-search-line"></i>
                  </div>
                </div>
                <div class="custom-select ml-3">
                  <div class="custom-select-selected text-sm">
                    <span>جميع الأنشطة</span>
                    <i class="ri-arrow-down-s-line"></i>
                  </div>
                  <div class="custom-select-options">
                    <div class="custom-select-option text-sm">جميع الأنشطة</div>
                    <div class="custom-select-option text-sm">تسجيل الدخول</div>
                    <div class="custom-select-option text-sm">
                      إدارة المستخدمين
                    </div>
                    <div class="custom-select-option text-sm">
                      إدارة المحطات
                    </div>
                    <div class="custom-select-option text-sm">
                      إدارة الصيانة
                    </div>
                    <div class="custom-select-option text-sm">
                      تغييرات النظام
                    </div>
                  </div>
                </div>
                <button
                  class="bg-white border border-gray-300 text-gray-700 px-4 py-2 rounded-button text-sm font-medium flex items-center whitespace-nowrap mr-3"
                >
                  <div class="w-5 h-5 flex items-center justify-center ml-1">
                    <i class="ri-download-line"></i>
                  </div>
                  <span>تصدير</span>
                </button>
              </div>
            </div>
            <div class="bg-white rounded shadow-sm overflow-hidden">
              <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                  <thead class="bg-gray-50">
                    <tr>
                      <th
                        scope="col"
                        class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        الوقت والتاريخ
                      </th>
                      <th
                        scope="col"
                        class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        المستخدم
                      </th>
                      <th
                        scope="col"
                        class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        النشاط
                      </th>
                      <th
                        scope="col"
                        class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        التفاصيل
                      </th>
                      <th
                        scope="col"
                        class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        عنوان IP
                      </th>
                    </tr>
                  </thead>
                  <tbody class="bg-white divide-y divide-gray-200">
                    <tr>
                      <td
                        class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"
                      >
                        19 أبريل 2025، 10:45 ص
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                          <div
                            class="h-8 w-8 rounded-full bg-blue-500 flex items-center justify-center text-white"
                          >
                            <span>أ</span>
                          </div>
                          <div class="mr-3">
                            <div class="text-sm font-medium text-gray-900">
                              أحمد محمد
                            </div>
                          </div>
                        </div>
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <span
                          class="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800"
                        >
                          تسجيل دخول
                        </span>
                      </td>
                      <td class="px-6 py-4 text-sm text-gray-500">
                        تم تسجيل الدخول إلى النظام بنجاح
                      </td>
                      <td
                        class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"
                      >
                        192.168.1.105
                      </td>
                    </tr>
                    <tr>
                      <td
                        class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"
                      >
                        19 أبريل 2025، 10:30 ص
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                          <div
                            class="h-8 w-8 rounded-full bg-blue-500 flex items-center justify-center text-white"
                          >
                            <span>أ</span>
                          </div>
                          <div class="mr-3">
                            <div class="text-sm font-medium text-gray-900">
                              أحمد محمد
                            </div>
                          </div>
                        </div>
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <span
                          class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800"
                        >
                          إضافة مستخدم
                        </span>
                      </td>
                      <td class="px-6 py-4 text-sm text-gray-500">
                        تمت إضافة مستخدم جديد: عبدالله القحطاني
                      </td>
                      <td
                        class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"
                      >
                        192.168.1.105
                      </td>
                    </tr>
                    <tr>
                      <td
                        class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"
                      >
                        19 أبريل 2025، 09:15 ص
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                          <div
                            class="h-8 w-8 rounded-full bg-green-500 flex items-center justify-center text-white"
                          >
                            <span>س</span>
                          </div>
                          <div class="mr-3">
                            <div class="text-sm font-medium text-gray-900">
                              سارة العبدالله
                            </div>
                          </div>
                        </div>
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <span
                          class="px-2 py-1 text-xs rounded-full bg-purple-100 text-purple-800"
                        >
                          تعديل صلاحيات
                        </span>
                      </td>
                      <td class="px-6 py-4 text-sm text-gray-500">
                        تم تعديل صلاحيات دور: مهندس كهرباء
                      </td>
                      <td
                        class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"
                      >
                        192.168.1.110
                      </td>
                    </tr>
                    <tr>
                      <td
                        class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"
                      >
                        18 أبريل 2025، 04:30 م
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                          <div
                            class="h-8 w-8 rounded-full bg-blue-500 flex items-center justify-center text-white"
                          >
                            <span>أ</span>
                          </div>
                          <div class="mr-3">
                            <div class="text-sm font-medium text-gray-900">
                              أحمد محمد
                            </div>
                          </div>
                        </div>
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <span
                          class="px-2 py-1 text-xs rounded-full bg-yellow-100 text-yellow-800"
                        >
                          تغيير إعدادات
                        </span>
                      </td>
                      <td class="px-6 py-4 text-sm text-gray-500">
                        تم تحديث إعدادات النظام: تغيير حدود الطاقة
                      </td>
                      <td
                        class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"
                      >
                        192.168.1.105
                      </td>
                    </tr>
                    <tr>
                      <td
                        class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"
                      >
                        18 أبريل 2025، 02:15 م
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                          <div
                            class="h-8 w-8 rounded-full bg-red-500 flex items-center justify-center text-white"
                          >
                            <span>ن</span>
                          </div>
                          <div class="mr-3">
                            <div class="text-sm font-medium text-gray-900">
                              نورة الشمري
                            </div>
                          </div>
                        </div>
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <span
                          class="px-2 py-1 text-xs rounded-full bg-red-100 text-red-800"
                        >
                          تعطيل حساب
                        </span>
                      </td>
                      <td class="px-6 py-4 text-sm text-gray-500">
                        تم تعطيل حساب المستخدم: فهد العنزي
                      </td>
                      <td
                        class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"
                      >
                        192.168.1.120
                      </td>
                    </tr>
                    <tr>
                      <td
                        class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"
                      >
                        18 أبريل 2025، 11:40 ص
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                          <div
                            class="h-8 w-8 rounded-full bg-yellow-500 flex items-center justify-center text-white"
                          >
                            <span>م</span>
                          </div>
                          <div class="mr-3">
                            <div class="text-sm font-medium text-gray-900">
                              محمد العتيبي
                            </div>
                          </div>
                        </div>
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <span
                          class="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800"
                        >
                          تسجيل دخول
                        </span>
                      </td>
                      <td class="px-6 py-4 text-sm text-gray-500">
                        تم تسجيل الدخول إلى النظام بنجاح
                      </td>
                      <td
                        class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"
                      >
                        192.168.1.115
                      </td>
                    </tr>
                    <tr>
                      <td
                        class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"
                      >
                        17 أبريل 2025، 03:20 م
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                          <div
                            class="h-8 w-8 rounded-full bg-blue-500 flex items-center justify-center text-white"
                          >
                            <span>أ</span>
                          </div>
                          <div class="mr-3">
                            <div class="text-sm font-medium text-gray-900">
                              أحمد محمد
                            </div>
                          </div>
                        </div>
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <span
                          class="px-2 py-1 text-xs rounded-full bg-indigo-100 text-indigo-800"
                        >
                          تحديث نظام
                        </span>
                      </td>
                      <td class="px-6 py-4 text-sm text-gray-500">
                        تم تثبيت تحديث النظام: v2.5.3
                      </td>
                      <td
                        class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"
                      >
                        192.168.1.105
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <!-- ! Notification Levels Tab Content -->
          <div
            id="content-notify"
            class="tab-content bg-white p-6 rounded-lg shadow-sm hidden"
          >
            <div class="flex justify-between items-center mb-6">
              <h3 class="text-lg font-medium text-gray-900">
                مستويات الإشعارات
              </h3>
              <button
                id="saveNotificationSettings"
                class="bg-blue-500 text-white px-4 py-2 rounded-button text-sm font-medium flex items-center whitespace-nowrap"
              >
                <div class="w-5 h-5 flex items-center justify-center ml-1">
                  <i class="ri-save-line"></i>
                </div>
                <span>حفظ الإعدادات</span>
              </button>
            </div>

            <div class="bg-gray-50 rounded-lg p-6 mb-6">
              <h4 class="text-md font-medium text-gray-900 mb-4">
                إعدادات الإشعارات العامة
              </h4>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div
                  class="flex items-center justify-between p-4 bg-white rounded-lg border"
                >
                  <div>
                    <h5 class="font-medium text-gray-900">
                      الإشعارات عبر البريد الإلكتروني
                    </h5>
                    <p class="text-sm text-gray-500">
                      استلام الإشعارات عبر البريد الإلكتروني
                    </p>
                  </div>
                  <label class="switch">
                    <input type="checkbox" checked />
                    <span class="slider round"></span>
                  </label>
                </div>

                <div
                  class="flex items-center justify-between p-4 bg-white rounded-lg border"
                >
                  <div>
                    <h5 class="font-medium text-gray-900">
                      الإشعارات عبر الرسائل النصية
                    </h5>
                    <p class="text-sm text-gray-500">
                      استلام الإشعارات عبر الرسائل النصية
                    </p>
                  </div>
                  <label class="switch">
                    <input type="checkbox" />
                    <span class="slider round"></span>
                  </label>
                </div>

                <div
                  class="flex items-center justify-between p-4 bg-white rounded-lg border"
                >
                  <div>
                    <h5 class="font-medium text-gray-900">إشعارات الطوارئ</h5>
                    <p class="text-sm text-gray-500">
                      إشعارات فورية للأحداث الحرجة
                    </p>
                  </div>
                  <label class="switch">
                    <input type="checkbox" checked />
                    <span class="slider round"></span>
                  </label>
                </div>

                <div
                  class="flex items-center justify-between p-4 bg-white rounded-lg border"
                >
                  <div>
                    <h5 class="font-medium text-gray-900">إشعارات الصيانة</h5>
                    <p class="text-sm text-gray-500">تذكيرات بجداول الصيانة</p>
                  </div>
                  <label class="switch">
                    <input type="checkbox" checked />
                    <span class="slider round"></span>
                  </label>
                </div>
              </div>
            </div>

            <div class="bg-gray-50 rounded-lg p-6">
              <h4 class="text-md font-medium text-gray-900 mb-4">
                مستويات الإشعارات حسب الأدوار
              </h4>
              <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                  <thead class="bg-gray-100">
                    <tr>
                      <th
                        scope="col"
                        class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        الدور
                      </th>
                      <th
                        scope="col"
                        class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        إشعارات الطوارئ
                      </th>
                      <th
                        scope="col"
                        class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        إشعارات الصيانة
                      </th>
                      <th
                        scope="col"
                        class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        إشعارات الأداء
                      </th>
                      <th
                        scope="col"
                        class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        إشعارات النظام
                      </th>
                      <th
                        scope="col"
                        class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"
                      >
                        الإجراءات
                      </th>
                    </tr>
                  </thead>
                  <tbody class="bg-white divide-y divide-gray-200">
                    <tr>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                          <div
                            class="w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center text-purple-600 ml-3"
                          >
                            <i class="ri-shield-star-line"></i>
                          </div>
                          <div class="text-sm font-medium text-gray-900">
                            مدير النظام
                          </div>
                        </div>
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <label class="switch">
                          <input type="checkbox" checked />
                          <span class="slider round"></span>
                        </label>
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <label class="switch">
                          <input type="checkbox" checked />
                          <span class="slider round"></span>
                        </label>
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <label class="switch">
                          <input type="checkbox" checked />
                          <span class="slider round"></span>
                        </label>
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <label class="switch">
                          <input type="checkbox" checked />
                          <span class="slider round"></span>
                        </label>
                      </td>
                      <td
                        class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"
                      >
                        <button class="text-blue-600 hover:text-blue-900">
                          <i class="ri-edit-line"></i>
                        </button>
                      </td>
                    </tr>
                    <tr>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                          <div
                            class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 ml-3"
                          >
                            <i class="ri-flashlight-line"></i>
                          </div>
                          <div class="text-sm font-medium text-gray-900">
                            مهندس كهرباء
                          </div>
                        </div>
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <label class="switch">
                          <input type="checkbox" checked />
                          <span class="slider round"></span>
                        </label>
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <label class="switch">
                          <input type="checkbox" checked />
                          <span class="slider round"></span>
                        </label>
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <label class="switch">
                          <input type="checkbox" checked />
                          <span class="slider round"></span>
                        </label>
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <label class="switch">
                          <input type="checkbox" />
                          <span class="slider round"></span>
                        </label>
                      </td>
                      <td
                        class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"
                      >
                        <button class="text-blue-600 hover:text-blue-900">
                          <i class="ri-edit-line"></i>
                        </button>
                      </td>
                    </tr>
                    <tr>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                          <div
                            class="w-8 h-8 rounded-full bg-yellow-100 flex items-center justify-center text-yellow-600 ml-3"
                          >
                            <i class="ri-tools-line"></i>
                          </div>
                          <div class="text-sm font-medium text-gray-900">
                            فني صيانة
                          </div>
                        </div>
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <label class="switch">
                          <input type="checkbox" checked />
                          <span class="slider round"></span>
                        </label>
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <label class="switch">
                          <input type="checkbox" checked />
                          <span class="slider round"></span>
                        </label>
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <label class="switch">
                          <input type="checkbox" />
                          <span class="slider round"></span>
                        </label>
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <label class="switch">
                          <input type="checkbox" />
                          <span class="slider round"></span>
                        </label>
                      </td>
                      <td
                        class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"
                      >
                        <button class="text-blue-600 hover:text-blue-900">
                          <i class="ri-edit-line"></i>
                        </button>
                      </td>
                    </tr>
                    <tr>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                          <div
                            class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center text-green-600 ml-3"
                          >
                            <i class="ri-dashboard-line"></i>
                          </div>
                          <div class="text-sm font-medium text-gray-900">
                            محصل
                          </div>
                        </div>
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <label class="switch">
                          <input type="checkbox" checked />
                          <span class="slider round"></span>
                        </label>
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <label class="switch">
                          <input type="checkbox" />
                          <span class="slider round"></span>
                        </label>
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <label class="switch">
                          <input type="checkbox" checked />
                          <span class="slider round"></span>
                        </label>
                      </td>
                      <td class="px-6 py-4 whitespace-nowrap">
                        <label class="switch">
                          <input type="checkbox" />
                          <span class="slider round"></span>
                        </label>
                      </td>
                      <td
                        class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"
                      >
                        <button class="text-blue-600 hover:text-blue-900">
                          <i class="ri-edit-line"></i>
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <!--! Roles Tab Content -->
          <div
            id="content-roles"
            class="tab-content bg-white p-6 rounded-lg shadow-sm hidden"
          >
            <div class="flex justify-between items-center mb-6">
              <div class="flex items-center space-x-reverse space-x-4">
                <h3 class="text-lg font-medium text-gray-900">
                  الأدوار والصلاحيات
                </h3>
                <div class="relative">
                  <input
                    type="text"
                    id="roleSearchInput"
                    placeholder="بحث عن دور..."
                    class="pr-10 pl-4 py-2 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-20 focus:border-primary"
                  />
                  <div class="absolute right-3 top-2.5 text-gray-400">
                    <i class="ri-search-line"></i>
                  </div>
                </div>
              </div>
              <button
                id="openRoleModal"
                class="bg-blue-500 text-white px-4 py-2 rounded-button text-sm font-medium flex items-center whitespace-nowrap hover:bg-blue-600 transition-all transform hover:scale-105"
              >
                <div class="w-5 h-5 flex items-center justify-center ml-1">
                  <i class="ri-add-line"></i>
                </div>
                <span>إضافة دور جديد</span>
              </button>
            </div>

            <div
              class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
              id="rolesContainer"
            >
              <!-- سيتم ملؤها بواسطة JavaScript -->
            </div>
          </div>

          <!-- نافذة إضافة/تعديل دور -->
          <div
            id="roleModal"
            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden"
          >
            <div
              class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl mx-4 transform transition-all scale-95 opacity-0"
              id="roleModalContent"
            >
              <!-- رأس النافذة -->
              <div
                class="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6 rounded-t-2xl flex justify-between items-center"
              >
                <h3
                  class="text-xl font-bold flex items-center"
                  id="roleModalTitle"
                >
                  <i class="ri-shield-star-line ml-3 text-2xl"></i>
                  <span>إضافة دور جديد</span>
                </h3>
                <button
                  id="closeRoleModalBtn"
                  class="text-white hover:bg-white hover:bg-opacity-20 rounded-full p-2 transition-all"
                >
                  <i class="ri-close-line text-2xl"></i>
                </button>
              </div>

              <!-- محتوى النافذة -->
              <form id="roleForm" class="p-6">
                <input type="hidden" id="roleId" value="" />

                <!-- معلومات الدور -->
                <div class="mb-8">
                  <h4
                    class="text-lg font-semibold text-gray-800 mb-4 flex items-center"
                  >
                    <i class="ri-information-line ml-2 text-blue-600"></i>
                    معلومات الدور
                  </h4>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- اسم الدور -->
                    <div>
                      <label
                        class="block text-sm font-medium text-gray-700 mb-2"
                      >
                        اسم الدور <span class="text-red-500">*</span>
                      </label>
                      <div class="relative">
                        <input
                          type="text"
                          id="roleName"
                          required
                          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
                          placeholder="مثال: مدير النظام"
                        />
                        <i
                          class="ri-shield-line absolute left-3 top-3.5 text-gray-400"
                        ></i>
                      </div>
                    </div>

                    <!-- وصف الدور -->
                    <div>
                      <label
                        class="block text-sm font-medium text-gray-700 mb-2"
                      >
                        وصف الدور
                      </label>
                      <div class="relative">
                        <textarea
                          id="roleDescription"
                          rows="3"
                          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all resize-none"
                          placeholder="وصف موجز للدور ومسؤولياته"
                        ></textarea>
                        <i
                          class="ri-file-text-line absolute left-3 top-3.5 text-gray-400"
                        ></i>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- الصلاحيات -->
                <div class="mb-8">
                  <h4
                    class="text-lg font-semibold text-gray-800 mb-4 flex items-center"
                  >
                    <i class="ri-key-line ml-2 text-purple-600"></i>
                    الصلاحيات
                  </h4>
                  <div
                    class="border-2 border-gray-200 rounded-xl p-4 bg-gray-50 max-h-96 overflow-y-auto"
                  >
                    <div
                      class="grid grid-cols-1 md:grid-cols-2 gap-4"
                      id="permissionsContainer"
                    >
                      <!-- سيتم ملؤها بواسطة JavaScript -->
                    </div>
                  </div>
                  <div class="mt-3 flex items-center justify-between">
                    <label class="flex items-center cursor-pointer">
                      <input
                        type="checkbox"
                        id="selectAllPermissions"
                        class="mr-2 h-4 w-4 text-blue-600 rounded"
                      />
                      <span class="text-sm text-gray-600">تحديد الكل</span>
                    </label>
                    <span class="text-sm text-gray-500" id="selectedCount"
                      >0 صلاحية محددة</span
                    >
                  </div>
                </div>

                <!-- إحصائيات الدور -->
                <div id="roleStats" class="hidden mb-6">
                  <h4
                    class="text-lg font-semibold text-gray-800 mb-4 flex items-center"
                  >
                    <i class="ri-bar-chart-line ml-2 text-green-600"></i>
                    إحصائيات الدور
                  </h4>
                  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-blue-50 rounded-lg p-4 text-center">
                      <div
                        class="text-2xl font-bold text-blue-600"
                        id="totalUsers"
                      >
                        0
                      </div>
                      <div class="text-sm text-gray-600">المستخدمون</div>
                    </div>
                    <div class="bg-green-50 rounded-lg p-4 text-center">
                      <div
                        class="text-2xl font-bold text-green-600"
                        id="totalPermissions"
                      >
                        0
                      </div>
                      <div class="text-sm text-gray-600">الصلاحيات</div>
                    </div>
                    <div class="bg-purple-50 rounded-lg p-4 text-center">
                      <div
                        class="text-2xl font-bold text-purple-600"
                        id="createdDate"
                      >
                        --
                      </div>
                      <div class="text-sm text-gray-600">تاريخ الإنشاء</div>
                    </div>
                  </div>
                </div>

                <!-- أزرار الحفظ والإلغاء -->
                <div
                  class="flex justify-end space-x-reverse space-x-3 pt-4 border-t border-gray-200"
                >
                  <button
                    type="button"
                    id="cancelRoleBtn"
                    class="px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-all"
                  >
                    إلغاء
                  </button>
                  <button
                    type="submit"
                    class="px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all flex items-center shadow-lg"
                  >
                    <i class="ri-save-line ml-2"></i>
                    <span id="saveRoleButtonText">حفظ الدور</span>
                  </button>
                </div>
              </form>
            </div>
          </div>

          <!-- رسالة تأكيد حذف الدور -->
          <div
            id="deleteRoleConfirmModal"
            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden"
          >
            <div
              class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full transform transition-all"
            >
              <div class="text-center">
                <div
                  class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-red-100 mb-4"
                >
                  <i class="ri-delete-bin-line text-red-600 text-3xl"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-900 mb-2">
                  تأكيد الحذف
                </h3>
                <p class="text-gray-500 mb-6">
                  هل أنت متأكد من أنك تريد حذف هذا الدور؟ سيتم حذف جميع
                  الصلاحيات المرتبطة به.
                </p>
                <div class="flex justify-center space-x-reverse space-x-3">
                  <button
                    id="cancelDeleteRoleBtn"
                    class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-all"
                  >
                    إلغاء
                  </button>
                  <button
                    id="confirmDeleteRoleBtn"
                    class="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-all"
                  >
                    حذف
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- رسالة النجاح -->
          <div
            id="successToast"
            class="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg transform translate-x-full transition-transform z-50"
          >
            <div class="flex items-center">
              <i class="ri-check-line text-xl ml-2"></i>
              <span id="successMessage">تمت العملية بنجاح</span>
            </div>
          </div>

          <script>
            document.addEventListener("DOMContentLoaded", function () {
              // إعدادات API
              const API_BASE_URL =
                "http://localhost/power-station/api/index.php";
              const authToken = localStorage.getItem("authToken");

              // عناصر DOM للأدوار
              const openRoleModalBtn = document.getElementById("openRoleModal");
              const roleModal = document.getElementById("roleModal");
              const roleModalContent =
                document.getElementById("roleModalContent");
              const closeRoleModalBtn =
                document.getElementById("closeRoleModalBtn");
              const cancelRoleBtn = document.getElementById("cancelRoleBtn");
              const roleForm = document.getElementById("roleForm");
              const roleModalTitle = document.getElementById("roleModalTitle");
              const saveRoleButtonText =
                document.getElementById("saveRoleButtonText");
              const roleIdInput = document.getElementById("roleId");
              const roleNameInput = document.getElementById("roleName");
              const roleDescriptionInput =
                document.getElementById("roleDescription");
              const permissionsContainer = document.getElementById(
                "permissionsContainer"
              );
              const rolesContainer = document.getElementById("rolesContainer");
              const deleteRoleConfirmModal = document.getElementById(
                "deleteRoleConfirmModal"
              );
              const cancelDeleteRoleBtn = document.getElementById(
                "cancelDeleteRoleBtn"
              );
              const confirmDeleteRoleBtn = document.getElementById(
                "confirmDeleteRoleBtn"
              );
              const roleSearchInput =
                document.getElementById("roleSearchInput");
              const selectAllPermissions = document.getElementById(
                "selectAllPermissions"
              );
              const selectedCount = document.getElementById("selectedCount");
              const roleStats = document.getElementById("roleStats");
              const successToast = document.getElementById("successToast");
              const successMessage = document.getElementById("successMessage");

              // متغيرات عامة
              let roles = [];
              let permissions = [];
              let roleIdToDelete = null;

              // تحميل بيانات الأدوار
              async function loadRoles() {
                try {
                  showLoading();

                  // تحميل الأدوار
                  const rolesResponse = await apiRequest("roles");
                  if (rolesResponse) {
                    roles = rolesResponse;
                  }

                  // تحميل الصلاحيات
                  const permissionsResponse = await apiRequest("permissions");
                  if (permissionsResponse) {
                    permissions = permissionsResponse;
                  }

                  renderRoles();
                  renderPermissionsCheckboxes([]);
                } catch (error) {
                  console.error("Error loading roles:", error);
                  showToast("حدث خطأ في تحميل بيانات الأدوار", "error");
                } finally {
                  hideLoading();
                }
              }

              // عرض الأدوار
              function renderRoles() {
                rolesContainer.innerHTML = "";

                if (roles.length === 0) {
                  rolesContainer.innerHTML = `
          <div class="col-span-full text-center py-12">
            <i class="ri-shield-line text-6xl text-gray-300 mb-4"></i>
            <p class="text-gray-500 text-lg">لا توجد أدوار متاحة</p>
            <p class="text-gray-400 text-sm mt-2">اضغط على "إضافة دور جديد" لإنشاء دور جديد</p>
          </div>
        `;
                  return;
                }

                roles.forEach((role) => {
                  const roleCard = document.createElement("div");
                  roleCard.className =
                    "bg-white border border-gray-200 rounded-xl shadow-md hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1";
                  roleCard.setAttribute("data-role-id", role.RoleID);

                  // تحديد لون الدور
                  const roleColors = {
                    1: "from-purple-500 to-purple-700",
                    2: "from-blue-500 to-blue-700",
                    3: "from-green-500 to-green-700",
                    4: "from-yellow-500 to-yellow-700",
                    5: "from-red-500 to-red-700",
                  };
                  const colorClass =
                    roleColors[role.RoleID] || "from-gray-500 to-gray-700";

                  roleCard.innerHTML = `
          <div class="p-6">
            <div class="flex justify-between items-start mb-4">
              <div class="flex items-center">
                <div class="w-12 h-12 rounded-full bg-gradient-to-r ${colorClass} flex items-center justify-center text-white ml-3 shadow-lg">
                  <i class="ri-shield-star-line text-xl"></i>
                </div>
                <div>
                  <h4 class="font-bold text-gray-900 text-lg">${role.Name}</h4>
                  <p class="text-gray-500 text-sm">${
                    role.Description || "لا يوجد وصف"
                  }</p>
                </div>
              </div>
              <div class="flex space-x-reverse space-x-2">
                <button class="text-gray-400 hover:text-blue-600 transition-colors edit-role-btn" data-id="${
                  role.RoleID
                }" title="تعديل">
                  <i class="ri-edit-line text-xl"></i>
                </button>
                <button class="text-gray-400 hover:text-red-600 transition-colors delete-role-btn" data-id="${
                  role.RoleID
                }" title="حذف">
                  <i class="ri-delete-bin-line text-xl"></i>
                </button>
              </div>
            </div>
            
            <div class="border-t pt-4">
              <div class="flex justify-between items-center mb-3">
                <h5 class="text-sm font-medium text-gray-700">الصلاحيات</h5>
                <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full">
                  ${role.PermissionsCount || 0} صلاحية
                </span>
              </div>
              <div class="max-h-32 overflow-y-auto">
                <div class="space-y-2" id="permissions-${role.RoleID}">
                  <!-- سيتم ملؤها بواسطة JavaScript -->
                </div>
              </div>
            </div>
          </div>
        `;

                  rolesContainer.appendChild(roleCard);

                  // تحميل صلاحيات الدور
                  loadRolePermissions(role.RoleID);
                });

                // إضافة أحداث الأزرار
                document.querySelectorAll(".edit-role-btn").forEach((btn) => {
                  btn.addEventListener("click", function () {
                    const roleId = this.getAttribute("data-id");
                    editRole(roleId);
                  });
                });

                document.querySelectorAll(".delete-role-btn").forEach((btn) => {
                  btn.addEventListener("click", function () {
                    const roleId = this.getAttribute("data-id");
                    confirmDeleteRole(roleId);
                  });
                });
              }

              // تحميل صلاحيات الدور
              async function loadRolePermissions(roleId) {
                try {
                  const response = await apiRequest(`roles&id=${roleId}`);
                  if (response && response.permissions) {
                    const permissionsContainer = document.getElementById(
                      `permissions-${roleId}`
                    );
                    permissionsContainer.innerHTML = response.permissions
                      .map(
                        (perm) => `
            <div class="flex items-center text-sm text-gray-600">
              <i class="ri-check-line text-green-500 ml-2"></i>
              ${perm.Description}
            </div>
          `
                      )
                      .join("");
                  }
                } catch (error) {
                  console.error("Error loading role permissions:", error);
                }
              }

              // عرض مربعات اختيار الصلاحيات
              function renderPermissionsCheckboxes(selectedPermissions = []) {
                permissionsContainer.innerHTML = "";

                if (permissions.length === 0) {
                  permissionsContainer.innerHTML = `
          <div class="col-span-full text-center py-4 text-gray-500">
            لا توجد صلاحيات متاحة
          </div>
        `;
                  return;
                }

                permissions.forEach((permission) => {
                  const permissionDiv = document.createElement("div");
                  permissionDiv.className =
                    "flex items-center p-3 bg-white rounded-lg border border-gray-200 hover:border-blue-300 transition-colors";

                  const isSelected = selectedPermissions.includes(
                    permission.PermissionID
                  );

                  permissionDiv.innerHTML = `
          <label class="custom-checkbox flex items-center cursor-pointer w-full">
            <input type="checkbox" name="permissions" value="${
              permission.PermissionID
            }" ${isSelected ? "checked" : ""} class="permission-checkbox">
            <span class="checkmark"></span>
            <div class="mr-3">
              <div class="font-medium text-gray-800">${
                permission.Description
              }</div>
              <div class="text-xs text-gray-500">${permission.Code}</div>
            </div>
          </label>
        `;

                  permissionsContainer.appendChild(permissionDiv);
                });

                // تحديث العداد
                updateSelectedCount();

                // إضافة حدث لكل checkbox
                document
                  .querySelectorAll(".permission-checkbox")
                  .forEach((checkbox) => {
                    checkbox.addEventListener("change", updateSelectedCount);
                  });
              }

              // تحديث عدد الصلاحيات المحددة
              function updateSelectedCount() {
                const selected = document.querySelectorAll(
                  ".permission-checkbox:checked"
                ).length;
                selectedCount.textContent = `${selected} صلاحية محددة`;

                // تحديث زر تحديد الكل
                const total = document.querySelectorAll(
                  ".permission-checkbox"
                ).length;
                selectAllPermissions.checked = selected === total && total > 0;
                selectAllPermissions.indeterminate =
                  selected > 0 && selected < total;
              }

              // فتح نافذة إضافة دور
              openRoleModalBtn.addEventListener("click", function () {
                roleModal.classList.remove("hidden");
                document.body.style.overflow = "hidden";
                roleModalTitle.innerHTML =
                  '<i class="ri-shield-star-line ml-3 text-2xl"></i><span>إضافة دور جديد</span>';
                saveRoleButtonText.textContent = "حفظ الدور";
                roleForm.reset();
                roleIdInput.value = "";
                roleStats.classList.add("hidden");
                renderPermissionsCheckboxes([]);

                // إظهار النافذة مع تأثير الحركة
                setTimeout(() => {
                  roleModalContent.classList.remove("scale-95", "opacity-0");
                  roleModalContent.classList.add("scale-100", "opacity-100");
                }, 10);
              });

              // إغلاق نافذة الدور
              function closeRoleModal() {
                roleModalContent.classList.remove("scale-100", "opacity-100");
                roleModalContent.classList.add("scale-95", "opacity-0");

                setTimeout(() => {
                  roleModal.classList.add("hidden");
                  document.body.style.overflow = "";
                  roleForm.reset();
                  roleIdInput.value = "";
                  roleStats.classList.add("hidden");
                }, 300);
              }

              closeRoleModalBtn.addEventListener("click", closeRoleModal);
              cancelRoleBtn.addEventListener("click", closeRoleModal);

              // إغلاق النافذة عند النقر خارجها
              roleModal.addEventListener("click", function (e) {
                if (e.target === roleModal) {
                  closeRoleModal();
                }
              });

              // حدث تحديد الكل
              selectAllPermissions.addEventListener("change", function () {
                const checkboxes = document.querySelectorAll(
                  ".permission-checkbox"
                );
                checkboxes.forEach((checkbox) => {
                  checkbox.checked = this.checked;
                });
                updateSelectedCount();
              });

              // معالجة تقديم نموذج الدور
              roleForm.addEventListener("submit", async function (e) {
                e.preventDefault();

                // جمع الصلاحيات المحددة
                const selectedPermissions = Array.from(
                  document.querySelectorAll('input[name="permissions"]:checked')
                ).map((checkbox) => parseInt(checkbox.value));

                const roleData = {
                  name: roleNameInput.value.trim(),
                  description: roleDescriptionInput.value.trim(),
                  permissions: selectedPermissions,
                };

                // التحقق من البيانات
                if (!roleData.name) {
                  showToast("يرجى إدخال اسم الدور", "error");
                  return;
                }

                try {
                  showLoading();

                  let response;
                  if (roleIdInput.value) {
                    // تعديل دور موجود
                    response = await apiRequest(
                      `roles&id=${roleIdInput.value}`,
                      "PUT",
                      roleData
                    );
                  } else {
                    // إضافة دور جديد
                    response = await apiRequest("roles", "POST", roleData);
                  }

                  if (response && response.success) {
                    closeRoleModal();
                    loadRoles();
                    showToast(
                      roleIdInput.value
                        ? "تم تحديث الدور بنجاح"
                        : "تم إضافة الدور بنجاح",
                      "success"
                    );
                  }
                } catch (error) {
                  console.error("Error saving role:", error);
                  showToast("حدث خطأ في حفظ بيانات الدور", "error");
                } finally {
                  hideLoading();
                }
              });

              // تعديل دور
              async function editRole(roleId) {
                try {
                  showLoading();

                  const response = await apiRequest(`roles&id=${roleId}`);
                  if (response) {
                    roleModal.classList.remove("hidden");
                    document.body.style.overflow = "hidden";
                    roleModalTitle.innerHTML =
                      '<i class="ri-edit-line ml-3 text-2xl"></i><span>تعديل دور</span>';
                    saveRoleButtonText.textContent = "تحديث الدور";

                    // ملء النموذج ببيانات الدور
                    roleIdInput.value = response.RoleID;
                    roleNameInput.value = response.Name;
                    roleDescriptionInput.value = response.Description || "";

                    // عرض الصلاحيات
                    const selectedPermissions = response.permissions.map(
                      (p) => p.PermissionID
                    );
                    renderPermissionsCheckboxes(selectedPermissions);

                    // عرض الإحصائيات
                    roleStats.classList.remove("hidden");
                    document.getElementById("totalUsers").textContent = "0"; // يمكن جلب هذا من الـ API
                    document.getElementById("totalPermissions").textContent =
                      response.permissions.length;
                    document.getElementById("createdDate").textContent =
                      new Date(response.CreatedAt).toLocaleDateString("ar-SA");

                    // إظهار النافذة مع تأثير الحركة
                    setTimeout(() => {
                      roleModalContent.classList.remove(
                        "scale-95",
                        "opacity-0"
                      );
                      roleModalContent.classList.add(
                        "scale-100",
                        "opacity-100"
                      );
                    }, 10);
                  }
                } catch (error) {
                  console.error("Error loading role:", error);
                  showToast("حدث خطأ في تحميل بيانات الدور", "error");
                } finally {
                  hideLoading();
                }
              }

              // تأكيد حذف دور
              function confirmDeleteRole(roleId) {
                roleIdToDelete = roleId;
                deleteRoleConfirmModal.classList.remove("hidden");
              }

              // حذف دور
              async function deleteRole() {
                try {
                  showLoading();

                  const response = await apiRequest(
                    `roles&id=${roleIdToDelete}`,
                    "DELETE"
                  );
                  if (response && response.success) {
                    deleteRoleConfirmModal.classList.add("hidden");
                    loadRoles();
                    showToast("تم حذف الدور بنجاح", "success");
                  }
                } catch (error) {
                  console.error("Error deleting role:", error);
                  showToast("حدث خطأ في حذف الدور", "error");
                } finally {
                  hideLoading();
                }
              }

              // أحداث أزرار حذف الدور
              cancelDeleteRoleBtn.addEventListener("click", function () {
                deleteRoleConfirmModal.classList.add("hidden");
              });

              confirmDeleteRoleBtn.addEventListener("click", deleteRole);

              // حدث البحث
              roleSearchInput.addEventListener("input", function () {
                const searchTerm = this.value.toLowerCase();
                const roleCards =
                  rolesContainer.querySelectorAll("[data-role-id]");

                roleCards.forEach((card) => {
                  const roleName = card
                    .querySelector("h4")
                    .textContent.toLowerCase();
                  const roleDesc = card
                    .querySelector("p")
                    .textContent.toLowerCase();

                  if (
                    roleName.includes(searchTerm) ||
                    roleDesc.includes(searchTerm)
                  ) {
                    card.style.display = "block";
                  } else {
                    card.style.display = "none";
                  }
                });
              });

              // دالة طلب API
              async function apiRequest(endpoint, method = "GET", data = null) {
                const options = {
                  method: method,
                  headers: {
                    "Content-Type": "application/json",
                    Authorization: `Bearer ${authToken}`,
                  },
                };

                if (data) {
                  options.body = JSON.stringify(data);
                }

                try {
                  const response = await fetch(
                    `${API_BASE_URL}?endpoint=${endpoint}`,
                    options
                  );
                  const result = await response.json();

                  if (!response.ok) {
                    throw new Error(result.error || "Request failed");
                  }

                  return result;
                } catch (error) {
                  console.error("API Error:", error);
                  throw error;
                }
              }

              // دالة عرض رسائل النجاح/الخطأ
              function showToast(message, type = "success") {
                successMessage.textContent = message;

                if (type === "error") {
                  successToast.className =
                    "fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg transform transition-transform z-50";
                } else {
                  successToast.className =
                    "fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg transform transition-transform z-50";
                }

                successToast.classList.remove("translate-x-full");

                setTimeout(() => {
                  successToast.classList.add("translate-x-full");
                }, 3000);
              }

              // دوال التحميل
              function showLoading() {
                // يمكن إضافة مؤشر تحميل هنا
              }

              function hideLoading() {
                // إخفاء مؤشر التحميل
              }

              // تحميل بيانات الأدوار عند بدء الصفحة
              loadRoles();
            });
          </script>

        </main>
      </div>
    </div>

    <!-- ! نافذة إضافة/تعديل مستخدم -->
    <div
      id="userModal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden"
    >
      <div
        class="bg-white rounded-xl shadow-2xl w-full max-w-2xl mx-4 transform transition-all"
      >
        <!-- رأس النافذة -->
        <div
          class="bg-blue-600 text-white p-5 rounded-t-xl flex justify-between items-center"
        >
          <h3 class="text-xl font-bold flex items-center" id="modalTitle">
            <i class="ri-user-add-line ml-2"></i>
            إضافة مستخدم جديد
          </h3>
          <button
            id="closeModalBtn"
            class="text-white hover:bg-blue-700 rounded-full p-2 transition"
          >
            <i class="ri-close-line text-xl"></i>
          </button>
        </div>

        <!-- محتوى النافذة -->
        <form id="userForm" class="p-6">
          <input type="hidden" id="userId" value="" />
          <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
            <!-- الاسم الكامل -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >الاسم الكامل</label
              >
              <div class="relative">
                <input
                  type="text"
                  id="fullName"
                  required
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  placeholder="أحمد محمد"
                />
                <i class="ri-user-line absolute left-3 top-3 text-gray-400"></i>
              </div>
            </div>

            <!-- اسم المستخدم -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >اسم المستخدم</label
              >
              <div class="relative">
                <input
                  type="text"
                  id="username"
                  required
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  placeholder="username"
                />
                <i
                  class="ri-user-3-line absolute left-3 top-3 text-gray-400"
                ></i>
              </div>
            </div>

            <!-- كلمة المرور -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >كلمة المرور</label
              >
              <div class="relative">
                <input
                  type="password"
                  id="password"
                  required
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  placeholder="••••••••"
                />
                <i class="ri-lock-line absolute left-3 top-3 text-gray-400"></i>
              </div>
            </div>

            <!-- البريد الإلكتروني -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >البريد الإلكتروني</label
              >
              <div class="relative">
                <input
                  type="email"
                  id="email"
                  required
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  placeholder="example@email.com"
                />
                <i class="ri-mail-line absolute left-3 top-3 text-gray-400"></i>
              </div>
            </div>

            <!-- رقم الهاتف -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >رقم الهاتف</label
              >
              <div class="relative">
                <input
                  type="tel"
                  id="phone"
                  required
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  placeholder="+966 50 123 4567"
                />
                <i
                  class="ri-phone-line absolute left-3 top-3 text-gray-400"
                ></i>
              </div>
            </div>

            <!-- الدور -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >الدور</label
              >
              <div class="relative">
                <select
                  id="role"
                  required
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none"
                >
                  <option value="" disabled selected>اختر الدور</option>
                  <option value="1">مدير النظام</option>
                  <option value="2">موظف</option>
                  <option value="3">محاسب</option>
                </select>
                <i
                  class="ri-arrow-down-s-line absolute left-3 top-3 text-gray-400 pointer-events-none"
                ></i>
              </div>
            </div>

            <!-- العنوان -->
            <div class="md:col-span-2">
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >العنوان</label
              >
              <div class="relative">
                <textarea
                  id="address"
                  rows="2"
                  required
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  placeholder="شارع الملك فهد، الرياض، المملكة العربية السعودية"
                ></textarea>
                <i
                  class="ri-map-pin-line absolute left-3 top-3 text-gray-400"
                ></i>
              </div>
            </div>

            <!-- ملاحظة -->
            <div class="md:col-span-2">
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >ملاحظة</label
              >
              <div class="relative">
                <textarea
                  id="note"
                  rows="2"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  placeholder="أدخل أي ملاحظات إضافية..."
                ></textarea>
                <i
                  class="ri-file-text-line absolute left-3 top-3 text-gray-400"
                ></i>
              </div>
            </div>
          </div>

          <!-- أزرار الحفظ والإلغاء -->
          <div
            class="flex justify-end space-x-reverse space-x-3 mt-6 pt-4 border-t border-gray-200"
          >
            <button
              type="button"
              id="cancelBtn"
              class="px-5 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition"
            >
              إلغاء
            </button>
            <button
              type="submit"
              class="px-5 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition flex items-center"
            >
              <i class="ri-save-line ml-2"></i>
              <span id="saveButtonText">حفظ المستخدم</span>
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- ! رسالة تأكيد الحذف -->
    <div
      id="deleteConfirmModal"
      class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden"
    >
      <div class="bg-white rounded-lg shadow-xl p-6 max-w-md w-full">
        <div class="text-center">
          <div
            class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4"
          >
            <i class="ri-delete-bin-line text-red-600 text-xl"></i>
          </div>
          <h3 class="text-lg font-medium text-gray-900 mb-2">تأكيد الحذف</h3>
          <p class="text-sm text-gray-500 mb-6">
            هل أنت متأكد من أنك تريد حذف هذا المستخدم؟ لا يمكن التراجع عن هذا
            الإجراء.
          </p>
          <div class="flex justify-center space-x-reverse space-x-3">
            <button
              id="cancelDeleteBtn"
              class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50"
            >
              إلغاء
            </button>
            <button
              id="confirmDeleteBtn"
              class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700"
            >
              حذف
            </button>
          </div>
        </div>
      </div>
    </div>

    <script src="/assets/js/common.js"></script>
    <script src="/assets/js/users.ui.js"></script>
    <!-- !+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ -->
  </body>
</html>
